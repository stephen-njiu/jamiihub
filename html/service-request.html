<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Service Requests - Community Information and Action App</title>
    <link rel="stylesheet" href="/css/service-request.css">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>

<body class="bg-gray-100 font-sans">
    <header class="bg-white shadow p-4 flex justify-between items-center">
        <div class="title flex items-center">
            <button id="back-button" class="btn-back text-gray-600 hover:text-blue-500 mr-2">
                &larr;
            </button>
            <h1 class="text-xl font-bold">Services</h1>
        </div>
        <button class="btnmodal bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600" id="post-service-btn">Post a Service</button>
    </header>

    <main class="p-4">
        <div class="modal fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50" id="post-service-modal" style="display:none;">
            <div class="modal-content bg-white rounded shadow-lg w-full max-w-md p-6 relative">
                <span class="close absolute top-2 right-2 cursor-pointer text-gray-600" id="close-modal">&times;</span>
                <h2 class="text-lg font-semibold mb-4">Post a Service</h2>
                <form id="service-form" action="/api/services" method="post" enctype="multipart/form-data">
                    <label class="block text-gray-700" for="serviceTitle">Service Title:</label>
                    <input class="w-full border border-gray-300 p-2 rounded mb-4" type="text" id="serviceTitle" name="serviceTitle" required>

                    <label class="block text-gray-700" for="serviceDescription">Description:</label>
                    <textarea class="w-full border border-gray-300 p-2 rounded mb-4" id="serviceDescription" name="serviceDescription" required></textarea>

                    <label class="block text-gray-700" for="serviceCategory">Category:</label>
                    <select class="w-full border border-gray-300 p-2 rounded mb-4" id="serviceCategory" name="serviceCategory" required>
                        <option value="">Select a category</option>
                        <option value="repairs">Repairs</option>
                        <option value="transport">Transport</option>
                        <option value="tutoring">Tutoring</option>
                        <option value="cleaning">Cleaning</option>
                    </select>

                    <label class="block text-gray-700" for="servicePrice">Price:</label>
                    <input class="w-full border border-gray-300 p-2 rounded mb-4" type="number" id="servicePrice" name="servicePrice" required>

                    <label class="block text-gray-700" for="serviceLocation">Location:</label>
                    <input class="w-full border border-gray-300 p-2 rounded mb-4" type="text" id="serviceLocation" name="serviceLocation" required>

                    <label class="block text-gray-700" for="serviceImage">Service Image:</label>
                    <input class="w-full border border-gray-300 p-2 rounded mb-4" type="file" id="serviceImage" name="serviceImage" required>

                    <button type="submit" class="btnmodal bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Post Service</button>
                </form>
            </div>
        </div>

        <section class="section1 mt-6">
            <section class="service-categories mb-4 flex flex-wrap gap-2">
                <button class="btn category-btn bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600" data-category="" onclick="filterByCategory('')">All</button>
                <button class="btn category-btn bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600" data-category="repairs" onclick="filterByCategory('repairs')">Repairs</button>
                <button class="btn category-btn bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600" data-category="transport" onclick="filterByCategory('transport')">Transport</button>
                <button class="btn category-btn bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600" data-category="tutoring" onclick="filterByCategory('tutoring')">Tutoring</button>
                <button class="btn category-btn bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600" data-category="cleaning" onclick="filterByCategory('cleaning')">Cleaning</button>
            </section>

            <div class="service-list">
                <h2 class="text-xl font-semibold mb-2">Available Services</h2>
                <ul id="services" class="bg-white rounded shadow p-4 space-y-2">
                    <!-- Service items will be dynamically inserted here -->
                </ul>
            </div>
        </section>
    </main>

    <script src="/js/service-requests.js"></script>
    <script>
        document.getElementById('post-service-btn').addEventListener('click', () => {
            document.getElementById('post-service-modal').style.display = 'flex';
        });

        document.getElementById('close-modal').addEventListener('click', () => {
            document.getElementById('post-service-modal').style.display = 'none';
        });

        document.getElementById('service-form').addEventListener('submit', async (event) => {
            event.preventDefault();

            const formData = new FormData(event.target);
            const token = localStorage.getItem("userToken"); // Retrieve token from local storage
            const username = localStorage.getItem("username"); // Retrieve username from local storage
            console.log("username", username)

            // Add username to formData
            if (username) {
                formData.append('username', username);
            } else {
                alert('Username not found. Please log in again.');
                return; // Stop submission if username is not found
            }

            const response = await fetch('http://localhost:5000/api/services', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}` // Add your token for authentication
                },
                body: formData,
            });

            if (response.ok) { // Check for a successful response
                const result = await response.json();
                if (result.success) {
                    alert('Service posted successfully!');
                    document.getElementById('post-service-modal').style.display = 'none'; // Close the modal
                    document.getElementById('service-form').reset(); // Reset the form
                } else {
                    alert('Error posting service: ' + result.message);
                }
            } else {
                alert('Error: ' + response.statusText);
            }
        });
    </script>
</body>

</html>
